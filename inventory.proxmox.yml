---
plugin: community.proxmox.proxmox

# Connection details via environment variables
# Required: PROXMOX_URL, PROXMOX_USER, PROXMOX_TOKEN_ID, PROXMOX_TOKEN_SECRET
# The user should be the username part of the token (e.g., ansible@pam)
# The token_id is the full token identifier (e.g., ansible@pam!semaphore)
validate_certs: false

# Gather VM facts
want_facts: true

# Use first IPv4 address as ansible_host
compose:
  ansible_host: ipv4_addresses[0] | default(ansible_host)
  ansible_python_interpreter: /usr/bin/python3
  ansible_user: ansible

# Create groups based on VM tags
# Each tag on a VM becomes a group
keyed_groups:
  - key: proxmox_tags_parsed
    separator: ""

# Create ubuntu meta-group for all VMs
groups:
  ubuntu: true
