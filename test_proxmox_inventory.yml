---
- name: List Proxmox Inventory Groups and Hosts
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Display groups with hosts and IPs
      debug:
        msg: |
          Group: {{ item }}
          Hosts: {% for host in groups[item] %}{{ host }} ({{ hostvars[host].ansible_host | default('NO IP') }}){% if not loop.last %}, {% endif %}{% endfor %}
      loop: "{{ groups.keys() | list | sort }}"
      when: item != 'all' and item != 'ungrouped'

- name: Debug all variables for one running QEMU VM
  hosts: proxmox_all_running
  gather_facts: false
  tasks:
    - name: Show all proxmox variables
      debug:
        msg: "{{ hostvars[inventory_hostname] | dict2items | selectattr('key', 'match', '^proxmox_') | list }}"
      when: inventory_hostname in groups['proxmox_all_qemu']
      run_once: true