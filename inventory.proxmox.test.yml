---
plugin: community.proxmox.proxmox

# Authentication
url: "{{ lookup('env', 'PROXMOX_URL') }}"
user: "{{ lookup('env', 'PROXMOX_USER') }}"
token_id: "{{ lookup('env', 'PROXMOX_TOKEN_ID') }}"
token_secret: "{{ lookup('env', 'PROXMOX_TOKEN_SECRET') }}"

# SSL validation
validate_certs: false

# Gather VM facts - REQUIRED for VMs
want_facts: true

# Don't set ansible_host for Proxmox nodes themselves
want_proxmox_nodes_ansible_host: false

# Minimal compose - set ansible_host using Proxmox variables
compose:
  ansible_host: proxmox_ipconfig0.ip | default(proxmox_net0.ip) | default(ansible_host)

# Create groups based on VM tags
keyed_groups:
  - key: proxmox_tags_parsed
    separator: ""
